<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:util="http://www.springframework.org/schema/util"
             xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
             http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd">

  <!-- Configuration of groups to roles and mapping of districts. -->

  <util:list id="groupsSuper" value-type="java.lang.String">
    <beans:value>SUPER</beans:value>
  </util:list>

  <util:list id="groupsEditor" value-type="java.lang.String">
    <beans:value>EDITOR</beans:value>
    <beans:value>ALTONA</beans:value>
  </util:list>

  <util:map id="groupsTodistricts" key-type="java.lang.String" value-type="java.util.List">
    <beans:entry key="ALTONA" value-ref="districtsAltona" />
    <beans:entry key="HARBURG" value-ref="districtsHarburg" />
    <beans:entry key="HAMBURGNORD" value-ref="districtsHamburgNord" />
  </util:map>

  <util:list id="districtsAltona" value-type="java.lang.String">
    <beans:value>Altona</beans:value>
  </util:list>

  <util:list id="districtsHarburg" value-type="java.lang.String">
    <beans:value>Harburg</beans:value>
  </util:list>

  <util:list id="districtsHamburgNord" value-type="java.lang.String">
    <beans:value>Hamburg-Nord</beans:value>
  </util:list>

  <!-- Activation and deactivation of role hierarchy. -->
  <!-- Currently, role hierarchy is activated and can be deactivated by removing the fourth constructor (index="3"). -->

  <beans:bean id="grantedAuthoritiesMapper"
              class="de.latlon.xplan.manager.web.spring.security.ActiveDirectoryGrantedAuthoritiesMapper">
    <beans:constructor-arg index="0">
      <beans:ref bean="groupsSuper" />
    </beans:constructor-arg>
    <beans:constructor-arg index="1">
      <beans:ref bean="groupsEditor" />
    </beans:constructor-arg>
    <beans:constructor-arg index="2">
      <beans:ref bean="groupsTodistricts" />
    </beans:constructor-arg>
    <beans:constructor-arg index="3">
      <beans:ref bean="roleHierarchy" />
    </beans:constructor-arg>
  </beans:bean>

  <!-- Configuration of role hierarchy. -->
  <!-- Currently, dynamic role hierarchy is configured. -->

  <beans:bean id="roleHierarchy" class="org.springframework.security.access.hierarchicalroles.RoleHierarchyImpl">
    <beans:property name="hierarchy">
      <beans:bean factory-bean="roleHierarchyScanner" factory-method="retrieveRoleHierarchy" />
    </beans:property>
  </beans:bean>

  <beans:bean id="roleHierarchyScanner"
              class="de.latlon.xplan.manager.web.spring.security.ActiveDirectoryRoleHierarchyScanner">
    <beans:constructor-arg index="0" value="${ldap.server.url}" />
    <beans:constructor-arg index="1" value="${ldap.server.domain}" />
    <beans:constructor-arg index="2" value="${ldap.server.searchUser}" />
    <beans:constructor-arg index="3" value="${ldap.server.searchPassword}" />
    <beans:constructor-arg index="4" value="${ldap.server.searchNode}" />
    <beans:constructor-arg index="5">
      <beans:ref bean="groupsSuper" />
    </beans:constructor-arg>
    <beans:constructor-arg index="6">
      <beans:ref bean="groupsEditor" />
    </beans:constructor-arg>
    <beans:constructor-arg index="7">
      <beans:ref bean="groupsTodistricts" />
    </beans:constructor-arg>
  </beans:bean>

</beans:beans>