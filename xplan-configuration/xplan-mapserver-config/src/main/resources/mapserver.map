MAP
    NAME "raster"
    STATUS ON
    #SIZE 600 400
    EXTENT 532191.8874 5912066.8036 604827.5275 5958735.7938
    UNITS meters
	RESOLUTION 96
	DEFRESOLUTION 96
	MAXSIZE 5000
    #SHAPEPATH "c:\apache24\data"
	IMAGECOLOR 255 255 255
	IMAGETYPE png

	OUTPUTFORMAT
	   NAME png
	   DRIVER AGG/PNG
	   MIMETYPE "image/png"
	   IMAGEMODE RGBA
	   EXTENSION "png"
	   FORMATOPTION "INTERLACE=OFF"
	   FORMATOPTION "QUANTIZE_DITHER=OFF"
	   FORMATOPTION "QUANTIZE_FORCE=ON"
	   FORMATOPTION "QUANTIZE=COLORS=256"
	END

	PROJECTION
	   "init=epsg:25832"
	END

   #
   # Start of web interface definition
   #
   WEB
      IMAGEPATH "/ms4w/tmp/ms_tmp/"
      IMAGEURL "/ms_tmp/"
	  #QUERYFORMAT "image/png"
	  METADATA
	  	 "wms_title" "xPlanBox Rasterdaten"
	  	 #"wms_onlineresource" "http://gv-srv-w00173:8080/cgi-bin/mapserv.exe?map=c:\apache24\data\tileindex.map" #must change mapfile path
	  	 "wms_srs" "EPSG:25832"
	  	 "wms_enable_request" "*"
	  END
   END # WEB

   #
   # BPlan Festgestellt
   #
   LAYER
	  NAME "bplanrastertindex"
	  #EXTENT 532191.8874 5912066.8036 604827.5275 5958735.7938
	  STATUS OFF
	  CONNECTION "user=postgres password=postgres dbname=xplanbox host=xplan-db-docker port=5432"
	  CONNECTIONTYPE POSTGIS
	  PROCESSING "CLOSE_CONNECTION=DEFER"
	  DATA "geom FROM (SELECT row_number() OVER () as ogc_fid, $1 || id || '_' || filename as location, ST_Transform(wkb_geometry,25832) as geom FROM
                      (SELECT
                      p.id as id,
                      a.filename as filename,
                      p.bbox as wkb_geometry
                      FROM xplanmgr.artefacts a
                      LEFT JOIN xplanmgr.plans p
                           ON a.plan = p.id
                      WHERE a.artefacttype='RASTERBASIS' AND p.planstatus = $2 AND xp_type = $3 ORDER BY p.wmssortdate) as sub1) as sub2 using unique ogc_fid using srid=25832"
         BINDVALS
            "1"  "/etc/mapserver/data/"
            "2"  "Festgestellt"
            "3"  "BP_Plan"
         END
	  PROJECTION
	  	 "init=epsg:25832"
	  END
	  TYPE POLYGON
   END # LAYER
   LAYER
	  NAME "bplanraster"
	  #EXTENT 532191.8874 5912066.8036 604827.5275 5958735.7938
	  STATUS ON
	  TILEINDEX "bplanrastertindex"
	  TILEITEM "location"
	  METADATA
	     "wms_title" "BPlan Raster (Festgestellt)"
	  END
	  PROJECTION
	     "init=epsg:25832"
      META
	  END
	  TYPE RASTER
   END # LAYER

   #
   # BPlan In Aufstellung
   #
   LAYER
	  NAME "bplanrasterpretindex"
	  #EXTENT 532191.8874 5912066.8036 604827.5275 5958735.7938
	  STATUS OFF
	  CONNECTION "user=postgres password=postgres dbname=xplanbox host=xplan-db-docker port=5432"
	  CONNECTIONTYPE POSTGIS
	  PROCESSING "CLOSE_CONNECTION=DEFER"
	  DATA "geom FROM (SELECT row_number() OVER () as ogc_fid, $1 || id || '_' || filename as location, ST_Transform(wkb_geometry,25832) as geom FROM
                      (SELECT
                      p.id as id,
                      a.filename as filename,
                      p.bbox as wkb_geometry
                      FROM xplanmgr.artefacts a
                      LEFT JOIN xplanmgr.plans p
                           ON a.plan = p.id
                      WHERE a.artefacttype='RASTERBASIS' AND p.planstatus = $2 AND xp_type = $3 ORDER BY p.wmssortdate) as sub1) as sub2 using unique ogc_fid using srid=25832"
         BINDVALS
            "1"  "/etc/mapserver/data/"
            "2"  "In Aufstellung"
            "3"  "BP_Plan"
         END
	  PROJECTION
	  	 "init=epsg:25832"
	  END
	  TYPE POLYGON
   END # LAYER

   LAYER
	  NAME "bplanrasterpre"
	  #EXTENT 532191.8874 5912066.8036 604827.5275 5958735.7938
	  STATUS ON
	  TILEINDEX "bplanrasterpretindex"
	  TILEITEM "location"
	  METADATA
	     "wms_title" "BPlan Raster (In Aufstellung)"
	  END
	  PROJECTION
	     "init=epsg:25832"
      META
	  END
	  TYPE RASTER
   END # LAYER

   #
   # BPlan Archiviert
   #
   LAYER
	  NAME "bplanrasterarchivetindex"
	  #EXTENT 532191.8874 5912066.8036 604827.5275 5958735.7938
	  STATUS OFF
	  CONNECTION "user=postgres password=postgres dbname=xplanbox host=xplan-db-docker port=5432"
	  CONNECTIONTYPE POSTGIS
	  PROCESSING "CLOSE_CONNECTION=DEFER"
	  DATA "geom FROM (SELECT row_number() OVER () as ogc_fid, $1 || id || '_' || filename as location, ST_Transform(wkb_geometry,25832) as geom FROM
                      (SELECT
                      p.id as id,
                      a.filename as filename,
                      p.bbox as wkb_geometry
                      FROM xplanmgr.artefacts a
                      LEFT JOIN xplanmgr.plans p
                           ON a.plan = p.id
                      WHERE a.artefacttype='RASTERBASIS' AND p.planstatus = $2 AND xp_type = $3 ORDER BY p.wmssortdate) as sub1) as sub2 using unique ogc_fid using srid=25832"
         BINDVALS
            "1"  "/etc/mapserver/data/"
            "2"  "Archiviert"
            "3"  "BP_Plan"
         END
	  PROJECTION
	     "init=epsg:25832"
	  END
	  TYPE POLYGON
   END # LAYER

   LAYER
	  NAME "bplanrasterarchive"
	  #EXTENT 532191.8874 5912066.8036 604827.5275 5958735.7938
	  STATUS ON
	  TILEINDEX "bplanrasterarchivetindex"
	  TILEITEM "location"
	  METADATA
	     "wms_title" "BPlan Raster (Archiviert)"
	  END
	  PROJECTION
	     "init=epsg:25832"
      META
	  END
	  TYPE RASTER
   END # LAYER
END # MAP
