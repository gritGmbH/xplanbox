###
# #%L
# xplan-mapproxy-config - Modul zur Gruppierung der Konfiguration
# %%
# Copyright (C) 2008 - 2023 Freie und Hansestadt Hamburg, developed by lat/lon gesellschaft für raumbezogene Informationssysteme mbH
# %%
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
# #L%
###
seeds:
  bpreseed:
    caches: [bplan_raster_cache,bplan_vektor_cache]
    grids: [gdi_de_25832]
    coverages: [bpchanges]
    refresh_before:
      days: 0
  fpreseed:
    caches: [fplan_raster_cache,fplan_vektor_cache]
    grids: [gdi_de_25832]
    coverages: [fpchanges]
    refresh_before:
      days: 0
  lpreseed:
    caches: [lplan_raster_cache,lplan_vektor_cache]
    grids: [gdi_de_25832]
    coverages: [lpchanges]
    refresh_before:
      days: 0
  rpreseed:
    caches: [rplan_raster_cache,rplan_vektor_cache]
    grids: [gdi_de_25832]
    coverages: [rpchanges]
    refresh_before:
      days: 0
  soreseed:
    caches: [soplan_raster_cache,soplan_vektor_cache]
    grids: [gdi_de_25832]
    coverages: [sochanges]
    refresh_before:
      days: 0
  # wird bei einem frischen Deployment vermutlich gar nicht benötigt?
  fullseed:
    caches: [bplan_raster_cache,bplan_vektor_cache,fplan_raster_cache,fplan_vektor_cache,lplan_raster_cache,lplan_vektor_cache,rplan_raster_cache,rplan_vektor_cache,soplan_raster_cache,soplan_vektor_cache]
    grids: [gdi_de_25832]
    coverages: [full]
    refresh_before:
      days: 0
coverages:
  bpchanges:
    # da die Connection mit PQconnectdb()/libpq gemacht wird, müssten alle Verbindungsparameter über ENVs gesetzt werden können: https://www.postgresql.org/docs/12/libpq-envars.html (ungetestet)
    datasource: "PG:"
    where: "select * from xplanmgr.planslog where xp_type='BP_Plan' and (planstatus_new='Festgestellt' or planstatus_old='Festgestellt') and last_update_date > localtimestamp - interval '1 day'"
    srs: 'EPSG:4326'
  fpchanges:
    datasource: "PG:"
    where: "select * from xplanmgr.planslog where xp_type='FP_Plan' and (planstatus_new='Festgestellt' or planstatus_old='Festgestellt') and last_update_date > localtimestamp - interval '1 day'"
    srs: 'EPSG:4326'
  lpchanges:
    datasource: "PG:"
    where: "select * from xplanmgr.planslog where xp_type='LP_Plan' and (planstatus_new='Festgestellt' or planstatus_old='Festgestellt') and last_update_date > localtimestamp - interval '1 day'"
    srs: 'EPSG:4326'
  rpchanges:
    datasource: "PG:"
    where: "select * from xplanmgr.planslog where xp_type='RP_Plan' and (planstatus_new='Festgestellt' or planstatus_old='Festgestellt') and last_update_date > localtimestamp - interval '1 day'"
    srs: 'EPSG:4326'
  sochanges:
    datasource: "PG:"
    where: "select * from xplanmgr.planslog where xp_type='SO_Plan' and (planstatus_new='Festgestellt' or planstatus_old='Festgestellt') and last_update_date > localtimestamp - interval '1 day'"
    srs: 'EPSG:4326'
  full:
    bbox: [${XPLAN_SERVICES_BBOX_4326}]
    srs: 'EPSG:4326'
