[[systemarchitektur-und-schnittstellen]]
== Systemarchitektur und Schnittstellen

Die folgende Abbildung zeigt die vereinfachte Darstellung der zentralen Komponenten des xPlanBox.

.Vereinfachte Darstellung der Komponenten der xPlanBox
image::Architektur_xPlanBox_einfach.png[Einfache Darstellung]

Das Gesamtsystem setzt sich aus folgenden Komponenten zusammen:

* <<xplanmanager-web, XPlanManagerWeb>>
* <<xplanmanager-api, XPlanManagerAPI>>
* <<xplanmanager-cli, XPlanManagerCLI>>
* <<xplanvalidator-web, XPlanValidatorWeb>> inkl. <<xplanvalidator-wms, XPlanValidatorWMS>>
* <<xplanvalidator-api, XPlanValidatorAPI>>
* <<xplanvalidator-cli, XPlanValidatorCLI>>
* <<xplandokumenten-api, XPlanDokumentenAPI>>
* <<xplantransform-cli, XPlanTransformCLI>>
* <<xplanevaluationschemasynchronize-cli, XPlanAuswerteschemaCLI>>
* <<xplanwms, XPlanWMS, XPlanArtWMS und XPlanWerkWMS>>
* <<xplanwfs, XPlanWFS>>
* <<xplansynwfs, XPlanSynWFS>>
* <<xplaninspirepluwms, XPlanInspirePluWMS>>
* <<xplaninspirepluwfs, XPlanInspirePluWFS>>
* <<xplanresources, XPlanRessourcen>>
* <<xplandb, XPlanDB>>

Die Gesamtarchitektur aller zuvor aufgelisteten Komponenten wird in der folgenden Abbildung dargestellt:

.Gesamtarchitektur aller Komponenten der xPlanBox
image::Architektur_xPlanBox_komplex.png[Komplexe Darstellung]

[[xplanmanager-web]]
=== XPlanManagerWeb

Die Komponente XPlanManagerWeb ist eine Web-Oberfläche, die dem
Fachadministrator der xPlanBox ermöglicht,
die Datenhaltung <<XPlanDB>> über einen Browser zu verwalten.

[[xplanmanager-api]]
=== XPlanManagerAPI

Die Komponente XPlanManagerAPI stellt eine REST-Schnittstelle bereit, über die
die Datenhaltung <<XPlanDB>> verwaltet werden kann.

[[xplanmanager-cli]]
=== XPlanManagerCLI

Die Komponente XPlanManagerCLI ist ein Kommandozeilenwerkzeug, welches
dem Fachadministrator der xPlanBox ermöglicht,
die Datenhaltung <<XPlanDB>> über das Terminal zu verwalten.

[[xplanvalidator-web]]
=== XPlanValidatorWeb

Die Komponente XPlanValidatorWeb ist eine Web-Oberfläche, welche dem
Fachadministrator der xPlanBox ermöglicht,
XPlanGML-Dokumente über den Browser zu validieren.

[[xplanvalidator-wms]]
==== XPlanValidatorWMS

Bei der Komponente XPlanValidatorWMS handelt es sich um eine Subkomponente
des XPlanValidatorWeb. Validierte Plänen können über den XPlanValidatorWMS in der Kartenvorschau angezeigt werden, ohne das ein Plan in die Datenhaltung importiert wird. Dieser Dienst kann ohne persistente Datenhaltung betrieben werden.

[[xplanvalidator-api]]
=== XPlanValidatorAPI

Die Komponente XPlanValidatorAPI stellt eine REST-Schnittstelle bereit, über die XPlanGML-Dokumente validiert werden können.

[[xplanvalidator-cli]]
=== XPlanValidatorCLI

Die Komponente XPlanValidatorCLI ist ein Kommandozeilenwerkzeug,
welches dem Fachadministrator der xPlanBox ermöglicht,
XPlanGML-Dokumente über das Terminal zu validieren.

[[xplandokumenten-api]]
=== XPlanDokumentenAPI

Die optionale Komponente XPlanDokumentenAPI stellt eine REST-Schnittstelle bereit, über die zu einem Plan zugehörigen Dokumente abgerufen werden können.

[[xplantransform-cli]]
=== XPlanTransformCLI

Die Komponente XPlanTransformCLI ist ein Kommandozeilenwerkzeug,
welches dem Fachadministrator der xPlanBox ermöglicht,
bereits über den XPlanManagerWeb oder das XPlanManagerCLI
importierte Pläne in eine aktuellere XPlanGML-Version zu transformieren und in der <<xplandb>> zu speichern.

[[xplanevaluationschemasynchronize-cli]]
=== XPlanAuswerteschemaCLI

Die Komponente XPlanAuswerteschemaCLI ist ein Kommandozeilenwerkzeug,
welches dem Fachadministrator der xPlanBox ermöglicht, ein weiteres Datenbankschema für die Auswertung zu erzeugen und die Daten aus dem XPlanSyn-Schema der XPlanDB mit dem des Auswerteschemas zu synchronisieren.

[[xplanwms]]
=== XPlanWMS, XPlanArtWMS und XPlanWerkWMS

Der XPlanWMS, XPlanArtWMS und XPlanWerkWMS sind auf dem Standard Web Map Service
(Version 1.1.1 und 1.3.0) des Open Geospatial Consortium (OGC)
basierende Kartendienste. Diese bieten die Möglichkeit,
Visualisierungen von Plandaten sowie Sachinformationsabfragen zu
einzelnen Planinhalten abzufragen.

Die Plandaten liegen in einer separaten Datenhaltung (siehe Abbildung 2) vor, d.h. je nachdem in welche Datenhaltung ein Plan
importiert wurde, ist dieser über den entsprechenden XPlanWMS-Endpoint abrufbar. Die folgende Tabelle zeigt die vom XPlanWMS
bereitgestellten Daten nach Planstatus.

[width="100%",cols="30%,40%,30%",options="header"]
|===
|Endpoint
|Planstatus
|Postfix für Schema und Endpoint
|XPlanWMSInAufstellung
|In Aufstellung
|_pre_
|XPlanWMSFestgestellt
|Festgestellt
|-
|XPlanWMSArchiviert
|Archiviert
|_archive_
|===

NOTE: Gleiches gilt für den XPlanWerkWMS, XPlanArtWMS, XPlanWFS und XPlanSynWFS

Der XPlanWMS greift auf dasselbe Datenbankschema wie der <<xplansynwfs>> in der <<xplandb>> zu. Rasterdaten werden im Workspace-Verzeichnis des XPlanWMS hinterlegt. Die Verzeichnisstruktur des Workspace <<appendix_xplanwms-workspace>> ist im Anhang dokumentiert.

Während der XPlanWMS planübergreifend arbeitet, beschränkt sich der
XPlanWerkWMS auf einzelne Planwerke. Der XPlanArtWMS stellt je einen Endpunkt für jede Planart wie z. B. BPlan oder FPlan zur Verfügung.


[[xplanwfs]]
=== XPlanWFS

Der XPlanWFS ist ein auf dem Standard Web Feature Service
(Version 1.1.0 und 2.0.0) des Open Geospatial Consortium (OGC)
basierender Dienst zur Abfrage von Vektordaten und stellt Endpunkte für jede XPlanGML-Version bereit. Zu jeder unterstützten XPlanGML-Version stellt die xPlanBox einen XPlanWFS-Endpoint bereit. Jeder Dienst greift auf das zu der XPlanGML-Version passende Datenbankschema in der <<xplandb>> zu. Die Zuordnung der einzelnen Endpunkte zu den Datenbankschemata ist im Kapitel <<datenzugriff-xplandb>> dokumentiert.

[[xplansynwfs]]
=== XPlanSynWFS

Der XPlanSynWFS dient der Abbildung des synthetisierten
XPlanGML-Anwendungsschemas (XPlanSynGML). Dieses stellt eine
vereinfachte und zusammenfassende Form der verschiedenen XPlanGML
Versionen dar. Der XPlanSynWFS greift auf das synthetisierte Datenbankschema in der <<xplandb>> zu.

[[xplaninspirepluwms]]
=== XPlanInspirePluWMS

Der XPlanInspirePluWMS ist ein INSPIRE View Service für die
Bereitstellung importierter Pläne im INSPIRE Datenthema Planned Land Use (PLU).

[[xplaninspirepluwfs]]
=== XPlanInspirePluWFS

Der XPlanInspirePluWFS ist ein INSPIRE Download Service für die
Bereitstellung importierter Pläne im INSPIRE Datenthema Planned Land Use (PLU).

[[xplanresources]]
=== XPlanRessourcen

Die optionale Komponente XPlanRessourcen bietet eine
Einstiegsseite zu den einzelnen Komponenten der xPlanBox und stellt
Testdaten sowie die Dokumente mit den Konformitätsbedingungen des Standards XPlanung bereit.

[[xplandb]]
=== XPlanDB

Die Komponente stellt die zentrale Datenhaltungskomponente für die alle Komponenten der xPlanBox bereit und wird durch eine PostgreSQL/PostGIS DB realisiert. Die Einrichtung der Datenbank ist im Kapitel <<konfiguration-der-datenbank>>, die Datenbankstruktur im Anhang <<appendix_xplandb>> sowie der Datenzugriff im Kapitel <<datenzugriff-xplandb>> beschrieben.